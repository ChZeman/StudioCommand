<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>StudioCommand — Administration</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body data-page="admin">
  <div id="app">
    <header class="topbar">
      <div class="brand">
        <div class="station" id="hdrTitle">StudioCommand</div>
        <div class="sub">Administration • System & Configuration</div>
      </div>

      <div class="clockblock">
        <div class="clock" id="clock">--:--:--</div>
        <div class="badges">
          <span class="badge badge-ok" id="engineBadge" title="Engine status">ENGINE OK</span>
          <span class="badge badge-ok" id="audioBadge" title="Audio health">AUDIO OK</span>
          <span class="badge badge-ok" id="streamBadge" title="Streaming status">STREAM OK</span>
          <span class="badge badge-ok" id="schedBadge" title="Scheduler status">SCHED OK</span>
          <span class="badge badge-demo" id="apiBadge" title="Data source">DEMO</span>
          <span class="badge badge-mode" id="modeBadge" title="User role">ADMIN</span>
        </div>
      </div>

      <div class="top-actions">
        <a class="btn btn-ghost" href="/remote" title="Go to Remote Studio">Remote Studio</a>
      </div>
    </header>

<!--
  Admin tabs (v0.1.92)
  - Horizontal tabs (operator-friendly)
  - Default tab: System
  - Supports deep links via hash: /admin#streaming, /admin#library, /admin#automation
  - Persists last tab in localStorage (sc_admin_tab)
-->
<nav class="admin-tabs" aria-label="Administration sections">
  <button class="admin-tab" id="tabbtn-system" type="button" data-tab="system" aria-controls="tab-system">System</button>
  <button class="admin-tab" id="tabbtn-streaming" type="button" data-tab="streaming" aria-controls="tab-streaming">Streaming</button>
  <button class="admin-tab" id="tabbtn-automation" type="button" data-tab="automation" aria-controls="tab-automation">Automation</button>
  <button class="admin-tab" id="tabbtn-library" type="button" data-tab="library" aria-controls="tab-library">Library</button>
  <button class="admin-tab" id="tabbtn-access" type="button" data-tab="access" aria-controls="tab-access" disabled title="Coming soon">Access</button>
</nav>


    <main class="layout" id="layout" style="grid-template-columns: 1fr;">
      <section class="panel" style="min-width:0;" id="tab-system" role="tabpanel" data-tabpanel="system" aria-labelledby="tabbtn-system">
        <div class="panel-title">
          <div>System Status</div>
          <div class="panel-meta">Engine • Audio • Streaming • Remote health</div>
        </div>

        <div class="mon-grid" style="margin-top:12px;">
          <div class="mon-card">
            <div class="mon-title">Engine</div>
            <div class="mon-row"><span>Uptime</span><span id="mUptime">—</span></div>
            <div class="mon-row"><span>CPU</span><span id="mCpu">—</span></div>
            <div class="mon-row"><span>Disk</span><span id="mDisk">—</span></div>
          </div>
          <div class="mon-card">
            <div class="mon-title">Audio</div>
            <div class="mon-row"><span>Underruns</span><span id="mUnderruns">—</span></div>
            <div class="mon-row"><span>Silence detect</span><span id="mSilence">—</span></div>
            <div class="mon-row"><span>Output</span><span id="mOutput">—</span></div>
          </div>
          <div class="mon-card">
            <div class="mon-title">Streaming</div>
            <div class="mon-row"><span>Status</span><span class="ok" id="mStream">—</span></div>
            <div class="mon-row"><span>Codec</span><span id="mCodec">—</span></div>
            <div class="mon-row"><span>Metadata</span><span id="mMeta">—</span></div>
          </div>
          <div class="mon-card">
            <div class="mon-title">Remote</div>
            <div class="mon-row"><span>Worst jitter</span><span id="mJitter">—</span></div>
            <div class="mon-row"><span>Worst loss</span><span id="mLoss">—</span></div>
            <div class="mon-row"><span>Mode</span><span id="mPriority">—</span></div>
          </div>
        </div>
      </section>

      <section class="panel" style="min-width:0;" id="tab-streaming" role="tabpanel" data-tabpanel="streaming" aria-labelledby="tabbtn-streaming" hidden>
        <div class="panel-title">
          <div>Streaming Output (Icecast)</div>
          <div class="panel-meta">Moved from producer UI</div>
        </div>

        <div class="mon-config" style="margin-top:12px;">
          <div class="form-grid">
            <label class="field"><span>Host</span><input class="input" id="outHost" placeholder="seahorse.juststreamwith.us" /></label>
            <label class="field"><span>Port</span><input class="input" id="outPort" placeholder="8006" /></label>
            <label class="field"><span>Mount</span><input class="input" id="outMount" placeholder="/studiocommand" /></label>
            <label class="field"><span>Username</span><input class="input" id="outUser" placeholder="source" /></label>
            <label class="field"><span>Password</span><input class="input" id="outPass" type="password" placeholder="••••••••" /></label>
            <label class="field"><span>Codec</span>
              <select class="select" id="outCodec"><option value="mp3">MP3</option><option value="aac">AAC</option></select>
            </label>
            <label class="field"><span>Bitrate (kbps)</span><input class="input" id="outBitrate" placeholder="128" /></label>
            <label class="field field-check"><span>Auto-start on boot</span><input type="checkbox" id="outEnabled" /></label>
          </div>
          <div class="form-actions">
            <button class="btn btn-secondary" id="btnOutSave">Save</button>
            <button class="btn btn-primary" id="btnOutStart">Start</button>
            <button class="btn btn-danger" id="btnOutStop">Stop</button>
            <div class="form-status">
              <div id="outStatusText">Status: —</div>
              <div class="mono">Listener URL: <span id="outListenerUrl">—</span></div>
            </div>
          </div>
        </div>
      </section>

      <section class="panel" style="min-width:0;" id="tab-automation" role="tabpanel" data-tabpanel="automation" aria-labelledby="tabbtn-automation" hidden>
        <div class="panel-title">
          <div>Top-up Configuration</div>
          <div class="panel-meta">Admin-only</div>
        </div>
        <div class="panel-body">
          <div class="muted">
            This section is reserved for top-up rules (auto-fill sources, target queue depth, and category weighting).
            The engine already performs top-up; the admin UI wiring will land here next.
          </div>
        </div>
      </section>

      <section class="panel" style="min-width:0;" id="tab-library" role="tabpanel" data-tabpanel="library" aria-labelledby="tabbtn-library" hidden>
        <div class="panel-title">
          <div>Library Maintenance</div>
          <div class="panel-meta">Scan • repair • housekeeping</div>
        </div>
        <div class="panel-body">
          <div class="muted">
            This section is reserved for library scanning / maintenance tools (rescan, rebuild metadata, and consistency checks).
            UI will be connected to engine endpoints as they are added.
          </div>
        </div>
      </section>
    </main>

    <div class="scrim" id="scrim" hidden></div>
  </div>

  
<script>
  /*
    Admin tab controller (small + dependency-free)
    - Clicking a tab hides other panels by toggling the [hidden] attribute
    - Active tab is stored in localStorage for operator convenience
    - URL hash enables deep links: /admin#streaming, etc.
  */
  (function () {
    const STORAGE_KEY = "sc_admin_tab";
    const tabs = Array.from(document.querySelectorAll(".admin-tab[data-tab]"));
    const panels = new Map(Array.from(document.querySelectorAll('[data-tabpanel]'))
      .map(p => [p.getAttribute("data-tabpanel"), p]));

    function setActive(name, {updateHash = true} = {}) {
      if (!panels.has(name)) name = "system";

      // Buttons
      for (const b of tabs) {
        const is = b.getAttribute("data-tab") === name;
        b.classList.toggle("is-active", is);
        b.setAttribute("aria-selected", String(is));
        b.setAttribute("tabindex", is ? "0" : "-1");
      }

      // Panels
      for (const [k, p] of panels.entries()) {
        if (k === name) p.removeAttribute("hidden");
        else p.setAttribute("hidden", "");
      }

      try { localStorage.setItem(STORAGE_KEY, name); } catch (_) {}
      if (updateHash) {
        // Keep URL stable and human readable; empty hash means "system"
        const h = (name === "system") ? "" : ("#" + name);
        if (location.hash !== h) history.replaceState(null, "", location.pathname + location.search + h);
      }
    }

    function pickInitial() {
      const fromHash = (location.hash || "").replace(/^#/, "").trim();
      if (fromHash && panels.has(fromHash)) return fromHash;
      try {
        const fromStore = localStorage.getItem(STORAGE_KEY);
        if (fromStore && panels.has(fromStore)) return fromStore;
      } catch (_) {}
      return "system";
    }

    // Wire clicks
    for (const b of tabs) {
      b.addEventListener("click", () => setActive(b.getAttribute("data-tab")));
    }

    // Hash changes (manual edits / bookmarks)
    window.addEventListener("hashchange", () => setActive(pickInitial(), {updateHash: true}));

    // Initial activation
    setActive(pickInitial(), {updateHash: true});
  })();
</script>
<script src="./app.js?v=0.1.93"></script>
</body>
</html>
